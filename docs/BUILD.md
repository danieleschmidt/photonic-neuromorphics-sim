# Build Documentation\n\nThis document describes how to build, test, and package the Photonic Neuromorphics Simulation Framework.\n\n## Prerequisites\n\n### System Requirements\n- Python 3.9 or higher\n- Docker (optional, for containerized builds)\n- Git\n- Make (for build automation)\n\n### Required System Packages\n\n#### Ubuntu/Debian\n```bash\nsudo apt-get update\nsudo apt-get install -y \\\n    build-essential \\\n    git \\\n    curl \\\n    wget \\\n    libhdf5-dev \\\n    libopenblas-dev \\\n    liblapack-dev \\\n    libfftw3-dev \\\n    gfortran \\\n    ngspice \\\n    gtkwave \\\n    graphviz \\\n    libgraphviz-dev \\\n    pkg-config\n```\n\n#### macOS\n```bash\nbrew install \\\n    git \\\n    python \\\n    hdf5 \\\n    openblas \\\n    fftw \\\n    ngspice \\\n    gtkwave \\\n    graphviz\n```\n\n## Quick Start\n\n### 1. Clone the Repository\n```bash\ngit clone https://github.com/danieleschmidt/photonic-neuromorphics-sim.git\ncd photonic-neuromorphics-sim\n```\n\n### 2. Set Up Development Environment\n```bash\n# Create virtual environment\npython -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\n\n# Install in development mode\nmake dev-setup\n```\n\n### 3. Run Tests\n```bash\nmake test-all\n```\n\n### 4. Build Package\n```bash\nmake build\n```\n\n## Build System Overview\n\nThe build system uses several tools working together:\n\n- **pyproject.toml**: Main project configuration\n- **Makefile**: Build automation and common tasks\n- **Dockerfile**: Multi-stage containerized builds\n- **docker-compose.yml**: Development environment orchestration\n- **scripts/build/**: Custom build scripts\n\n## Build Targets\n\n### Development Targets\n\n#### `make install`\nInstall the package in development mode:\n```bash\nmake install\n```\n\n#### `make install-dev`\nInstall with development dependencies:\n```bash\nmake install-dev\n```\n\n#### `make dev-setup`\nComplete development environment setup:\n```bash\nmake dev-setup\n```\n\n### Testing Targets\n\n#### `make test`\nRun basic test suite:\n```bash\nmake test\n```\n\n#### `make test-all`\nRun comprehensive test suite with coverage:\n```bash\nmake test-all\n```\n\n#### `make test-unit`\nRun only unit tests:\n```bash\nmake test-unit\n```\n\n#### `make test-integration`\nRun only integration tests:\n```bash\nmake test-integration\n```\n\n#### `make test-performance`\nRun performance benchmarks:\n```bash\nmake test-performance\n```\n\n#### `make test-security`\nRun security tests:\n```bash\nmake test-security\n```\n\n### Code Quality Targets\n\n#### `make lint`\nRun all linting checks:\n```bash\nmake lint\n```\n\n#### `make format`\nFormat code automatically:\n```bash\nmake format\n```\n\n#### `make type`\nRun type checking:\n```bash\nmake type\n```\n\n#### `make security-scan`\nRun security scanning:\n```bash\nmake security-scan\n```\n\n### Photonic Validation Targets\n\n#### `make validate-spice`\nValidate SPICE netlists:\n```bash\nmake validate-spice\n```\n\n#### `make validate-verilog`\nValidate Verilog modules:\n```bash\nmake validate-verilog\n```\n\n#### `make validate-layouts`\nValidate GDS layout files:\n```bash\nmake validate-layouts\n```\n\n#### `make benchmark`\nRun performance benchmarks:\n```bash\nmake benchmark\n```\n\n### Docker Targets\n\n#### `make docker-build`\nBuild all Docker images:\n```bash\nmake docker-build\n```\n\n#### `make docker-test`\nRun tests in Docker container:\n```bash\nmake docker-test\n```\n\n#### `make docker-dev`\nStart development environment:\n```bash\nmake docker-dev\n```\n\n### Build & Release Targets\n\n#### `make clean`\nClean build artifacts:\n```bash\nmake clean\n```\n\n#### `make build`\nBuild distribution packages:\n```bash\nmake build\n```\n\n#### `make release`\nBuild and upload to PyPI:\n```bash\nmake release\n```\n\n## Advanced Build Options\n\n### Custom Build Script\n\nUse the advanced build script for more control:\n\n```bash\n# Basic build\n./scripts/build/build.sh\n\n# Skip tests for faster builds\n./scripts/build/build.sh --skip-tests\n\n# Production build with Docker\n./scripts/build/build.sh --environment production --docker\n\n# Verbose build with all options\n./scripts/build/build.sh --verbose --docker --environment production\n```\n\n### Docker Build Script\n\nUse the Docker build script for advanced containerization:\n\n```bash\n# Basic Docker build\n./scripts/build/docker-build.sh\n\n# Build and push to registry\n./scripts/build/docker-build.sh --registry your-registry.com --push\n\n# Build with custom tag prefix\n./scripts/build/docker-build.sh --tag-prefix v1.0-\n\n# Build without running tests\n./scripts/build/docker-build.sh --no-tests\n```\n\n## Docker Development Environment\n\n### Starting Services\n\n```bash\n# Start development environment\ndocker-compose up dev\n\n# Start with Jupyter notebook\ndocker-compose up notebook\n\n# Start documentation server\ndocker-compose up docs\n\n# Start SPICE simulation service\ndocker-compose up spice\n\n# Start layout service\ndocker-compose up layout\n```\n\n### Service Ports\n\n- **Development**: Interactive shell\n- **Jupyter**: http://localhost:8888\n- **Documentation**: http://localhost:8000\n- **Layout Service**: http://localhost:8080\n- **Monitoring**: http://localhost:8081\n- **Database**: localhost:5432\n- **Cache**: localhost:6379\n\n## CI/CD Integration\n\n### GitHub Actions\n\nThe build system integrates with GitHub Actions:\n\n```yaml\n# Example workflow step\n- name: Run CI build\n  run: make ci-build\n\n- name: Build Docker images\n  run: ./scripts/build/docker-build.sh --push\n```\n\n### Pre-commit Hooks\n\nAutomatic code quality checks:\n\n```bash\n# Install pre-commit hooks\npre-commit install\n\n# Run hooks manually\npre-commit run --all-files\n```\n\n## Build Configuration\n\n### Environment Variables\n\nCommon environment variables for builds:\n\n```bash\n# Python configuration\nexport PYTHONPATH=./src\nexport PYTHONDONTWRITEBYTECODE=1\nexport PYTHONUNBUFFERED=1\n\n# Build configuration\nexport BUILD_ENVIRONMENT=production\nexport SKIP_TESTS=false\nexport VERBOSE_BUILD=true\n\n# Docker configuration\nexport DOCKER_BUILDKIT=1\nexport COMPOSE_DOCKER_CLI_BUILD=1\n\n# Registry configuration\nexport DOCKER_REGISTRY=your-registry.com\nexport IMAGE_TAG_PREFIX=v1.0-\n```\n\n### Build Customization\n\nCustomize builds through configuration files:\n\n#### pyproject.toml\n```toml\n[tool.build-system]\nrequires = [\"setuptools>=64\", \"wheel\"]\nbuild-backend = \"setuptools.build_meta\"\n\n[project.optional-dependencies]\ndev = [\"pytest\", \"black\", \"ruff\", \"mypy\"]\ndocs = [\"sphinx\", \"sphinx_rtd_theme\"]\n```\n\n#### Dockerfile build args\n```dockerfile\nARG PYTHON_VERSION=3.11\nARG BUILD_ENVIRONMENT=production\nARG ENABLE_CUDA=false\n```\n\n## Troubleshooting\n\n### Common Build Issues\n\n#### 1. Missing System Dependencies\n```bash\n# Error: \"ngspice not found\"\nsudo apt-get install ngspice\n\n# Error: \"hdf5 not found\"\nsudo apt-get install libhdf5-dev\n```\n\n#### 2. Permission Issues\n```bash\n# Fix script permissions\nchmod +x scripts/build/*.sh\n\n# Fix Docker permissions\nsudo usermod -aG docker $USER\n```\n\n#### 3. Memory Issues\n```bash\n# Increase Docker memory limit\ndocker system prune -f\n\n# Run tests with less parallelization\npytest -n 2 tests/\n```\n\n#### 4. Network Issues\n```bash\n# Use pip cache\npip install --cache-dir .pip-cache -r requirements.txt\n\n# Docker build with cache\ndocker build --cache-from photonic-neuromorphics:latest .\n```\n\n### Performance Optimization\n\n#### Build Speed\n```bash\n# Use parallel builds\nmake -j4 build\n\n# Skip slow tests\nmake test PYTEST_ARGS=\"-m 'not slow'\"\n\n# Use Docker layer caching\ndocker build --cache-from photonic-neuromorphics:dev .\n```\n\n#### Resource Usage\n```bash\n# Limit Docker memory\ndocker run -m 4g photonic-neuromorphics:test\n\n# Limit test parallelization\npytest -n 2 tests/\n```\n\n## Release Process\n\n### Semantic Versioning\n\nThe project uses semantic versioning:\n\n- **Major**: Breaking changes\n- **Minor**: New features (backward compatible)\n- **Patch**: Bug fixes (backward compatible)\n\n### Automated Releases\n\nReleases are automated using semantic-release:\n\n```bash\n# Trigger release (on main branch)\ngit commit -m \"feat: add new photonic component\"\ngit push origin main\n```\n\n### Manual Release\n\n```bash\n# Build and test\nmake ci-build\n\n# Tag release\ngit tag v1.0.0\ngit push origin v1.0.0\n\n# Build and upload\nmake release\n```\n\n## Monitoring and Metrics\n\n### Build Metrics\n\n- Build time tracking\n- Test coverage reporting\n- Security scan results\n- Performance benchmarks\n\n### Monitoring Tools\n\n- **cAdvisor**: Container metrics\n- **Prometheus**: Metrics collection\n- **Grafana**: Metrics visualization\n\n## Best Practices\n\n### Development Workflow\n\n1. **Always use virtual environments**\n2. **Run tests before committing**\n3. **Use pre-commit hooks**\n4. **Follow conventional commits**\n5. **Update documentation**\n\n### Docker Best Practices\n\n1. **Use multi-stage builds**\n2. **Minimize layer count**\n3. **Use .dockerignore**\n4. **Run as non-root user**\n5. **Pin base image versions**\n\n### Security Best Practices\n\n1. **Scan dependencies regularly**\n2. **Use security linting**\n3. **Keep base images updated**\n4. **Never commit secrets**\n5. **Use least privilege principle**\n\n## Support\n\nFor build-related issues:\n\n1. Check this documentation\n2. Review build logs\n3. Check GitHub Issues\n4. Ask in Discussions\n5. Contact maintainers\n\n---\n\n*This documentation is automatically updated with each release.*