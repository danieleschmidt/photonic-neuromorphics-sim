[tox]
min_version = 4.0
env_list = py{39,310,311,312}, lint, type, docs

[testenv]
description = Run tests with pytest
deps = 
    -r{toxinidir}/requirements-dev.txt
commands = 
    pytest {posargs:tests}

[testenv:lint]
description = Run linting checks
deps = 
    black
    ruff
commands = 
    black --check --diff src tests
    ruff check src tests

[testenv:format]
description = Format code with black and ruff
deps = 
    black
    ruff
commands = 
    black src tests
    ruff check --fix src tests

[testenv:type]
description = Run type checking with mypy
deps = 
    mypy
    -r{toxinidir}/requirements.txt
commands = 
    mypy src

[testenv:docs]
description = Build documentation
deps = 
    sphinx
    sphinx_rtd_theme
    sphinxcontrib-mermaid
changedir = docs
commands = 
    sphinx-build -b html . _build/html {posargs}

[testenv:docs-live]
description = Build and serve docs with live reload
deps = 
    sphinx-autobuild
    sphinx_rtd_theme
    sphinxcontrib-mermaid
changedir = docs
commands = 
    sphinx-autobuild . _build/html --host 0.0.0.0 --port 8000

[testenv:clean]
description = Clean build artifacts
deps = 
skip_install = true
commands = 
    python -c "import shutil; shutil.rmtree('build', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('dist', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('src/*.egg-info', ignore_errors=True)"